(module
  (import "c4wa" "printf" (func $printf (param i32) (param i32)))
  (memory (export "memory") 1)
  (data (i32.const 1024) "Hello!\00String <%s> consists of %d characters: \00'%c'\00, \00.\5Cn\00")
  (func $strlen (param $str i32) (result i32)
    (local $n i32)
    (set_local $n (i32.const 0))
    (loop $@block_1_continue
      (set_local $str (i32.add (get_local $str) (i32.const 1)))
      (set_local $n (i32.add (get_local $n) (i32.const 1)))
      (br_if $@block_1_continue (i32.ne (i32.load8_s (get_local $str)) (i32.const 0))))
    (return (get_local $n)))
  (func $main (export "main") (result i32)
    (local $hello i32)
    (local $len i32)
    (set_local $hello (i32.const 1024))
    (set_local $len (i32.const 57))
    (i64.store (i32.const 0) (i64.const 1031))
    (i64.store (i32.const 8) (i64.extend_i32_s (get_local $hello)))
    (i64.store (i32.const 16) (i64.extend_i32_s (call $strlen (get_local $hello))))
    (call $printf (i32.const 0) (i32.const 3))
    (loop $@block_1_continue
      (i64.store (i32.const 24) (i64.const 1071))
      (i64.store (i32.const 32) (i64.extend_i32_s (i32.load8_s (get_local $hello))))
      (call $printf (i32.const 24) (i32.const 2))
      (set_local $hello (i32.add (get_local $hello) (i32.const 1)))
      (if (i32.ne (i32.load8_s (get_local $hello)) (i32.const 0))
        (then
          (i64.store (i32.const 40) (i64.const 1076))
          (call $printf (i32.const 40) (i32.const 1))))
      (br_if $@block_1_continue (i32.ne (i32.load8_s (get_local $hello)) (i32.const 0))))
    (i64.store (i32.const 0) (i64.const 1079))
    (call $printf (i32.const 0) (i32.const 1))
    (return (i32.const 0))))
